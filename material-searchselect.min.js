/**
 * Material design searchable multiselect component
 * @version v1.0.0
 * @copyright 2018 Peter Kuti
 */

(()=>{"use strict";let a=function(d,e){return this instanceof a?void(this.configuration=Object.assign(this.defaults,e),this.configuration.isMultiselect=this.checkMultiselect(d),this.initialize(d)):new a(d,e)};a.prototype={defaults:{separator:",",showCheckboxes:!1},initialize:function(d){this.applySearchselect(d)},checkMultiselect:function(d){return!!$(d).find("select").attr("multiple")},applySearchselect:function(d){let e=this.initializeDisplay(d);b.setOptionsHeight(e),this.setSelectWidth(d,e),this.handleVisibility(e),this.subscribeOptionSelected(d),this.subscribeForSearch(e)},initializeDisplay:function(d){let e=$("<div class='searchselect-container'><div class='searchselect-input'><div><label class='searchselect-label'></label></div><div class='searchselect-labelcontainer'><label class='searchselect-datalabel searchselect-inner-input'><input type='text' class='searchselect-search' /><i class='searchselect-dropdown-icon material-icons'>keyboard_arrow_down</i></label></div></div></div>"),f=$("<ul class='searchselect-options'></ul>"),g=$(d).find("option"),h=this.configuration.showCheckboxes?"has-checkbox":"";$.each(g,function(j,k){f.append($(`<li class='searchselect-option ${h}' data-val='${k.value}'>${k.text}</li>`))}),e.find(".searchselect-input").append(f);let i=$(d).children(".searchselect-label");return i.hide(),e.find(".searchselect-label").text(i.text()),$(d).find("select").hide(),$(d).append(e),e},setSelectWidth:function(d,e){$(d).width()?(e.width($(d).width()),e.find(".searchselect-input").width($(d).width())):e.width(300)},handleVisibility:function(d){let e=d.find(".searchselect-input .searchselect-search");e.focus(function(){$(this).closest(".searchselect-container").addClass("is-focused"),$(this).closest(".searchselect-container").find(".searchselect-options").addClass("is-visible")}),e.blur(function(){$(this).closest(".searchselect-container").removeClass("is-focused"),$(this).closest(".searchselect-container").find(".searchselect-options").removeClass("is-visible")}),e.keyup(function(){b.handleInputIsDirty(this)}),d.find(".searchselect-input").on("click",function(){$(this).find(".searchselect-search").focus()}),d.find(".searchselect-dropdown-icon").on("click",function(f){$(this).hasClass("is-open")?($(this).removeClass("is-open"),f.stopImmediatePropagation(),f.preventDefault()):$(this).addClass("is-open")})},subscribeOptionSelected:function(d){function e(n){n.hasClass("selected")?g(n):h(n),b.handleInputIsDirty(d)}function f(n){let o=n.closest(".searchselect-input"),p=o.find(".searchselect-labelcontainer"),q=o.find(".searchselect-option.selected");$.each(q,function(r,s){g($(s))}),n.addClass("selected"),$(d).find(`select > option[value=${$(n).data("val")}]`).attr("selected","selected"),p.prepend($(`<label class="searchselect-selected searchselect-datalabel" data-val="${n.data("val")}">${n.text()}</label>`))}function g(n){n.removeClass("selected"),$(d).find(`select > option[value=${$(n).data("val")}]`).removeAttr("selected");let o=n.closest(".searchselect-input").find(".searchselect-labelcontainer .searchselect-selected").filter(function(p,q){return $(q).data("val")===n.data("val")});o.remove()}function h(n){n.addClass("selected"),$(d).find(`select > option[value=${$(n).data("val")}]`).attr("selected","selected"),i(n)}function i(n){function o(r){n.closest(".searchselect-input").find(".searchselect-labelcontainer .searchselect-selected").filter(function(s,t){return $(t).data("val")===$(r).data("val")}).after($(`<label class="searchselect-selected searchselect-datalabel" data-val="${n.data("val")}">${n.text()}</label>`))}function p(){n.closest(".searchselect-input").find(".searchselect-labelcontainer").prepend($(`<label class="searchselect-selected searchselect-datalabel" data-val="${n.data("val")}">${n.text()}</label>`))}let q=$(n.prevAll());q.length?$.each(q,function(r,s){return $(d).find("select").val().includes($(s).data("val"))?(o(s),!1):r!==q.length-1||(p(),!1)}):p()}function j(n){let r=n.closest(".searchselect-input"),s=r.find(".searchselect-labelcontainer .searchselect-selected"),t=r.find(".searchselect-inner-input"),u=-1,v=0;$.each(s,function(w,x){w<s.length-1&&b.insertSeparator(x,l),v+=$(x).outerWidth(),v>r.outerWidth()&&(v=$(x).outerWidth(),u=w-1)}),function(){r.outerWidth()-v<parseInt(t.css("min-width"),10)?(t.width(r.outerWidth()),u=s.length-1):t.width(r.outerWidth()-v)}(),function(){$.each(s,function(w,x){w<=u?$(x).addClass("searchselect-previous-row"):$(x).removeClass("searchselect-previous-row")})}(),function(){let w=r.find(".searchselect-options");w.css("top",r.outerHeight()-parseInt(r.css("padding-bottom"),10)+"px")}()}function k(){let n=$(d).find(".searchselect-search");n.val(""),n.trigger("keyup")}let l=this.configuration.separator,m=this.configuration.isMultiselect;$(".searchselect-option").on("mousedown",function(){m?e($(this)):f($(this)),j($(this)),k()})},subscribeForSearch:function(d){d.find(".searchselect-search").keyup(function(){let e=$(this),f=$(this).val().replace(/[.*+?^${}()|[\]\\]/g,"\\$&");var g=new RegExp(f,"i");e.closest(".searchselect-input").find(".searchselect-option").hide(),e.closest(".searchselect-input").find(".searchselect-option").filter(function(h,i){return g.test($(i).text())}).show(),b.setOptionsHeight(d)})}};class b{static handleInputIsDirty(d){let e=$(d).closest(".searchselect"),f=$(e).find("select").val().length||$(e).find(".searchselect-search").val();f?$(e).find(".searchselect-container").addClass("is-dirty"):$(e).find(".searchselect-container").removeClass("is-dirty")}static setOptionsHeight(d){d.find(".searchselect-options").height(48*d.find(".searchselect-option:visible").length)}static insertSeparator(d,e){let f=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),g=new RegExp(f,"i");$(d).text(`${$(d).text().trim().replace(g,"")}${e}`)}}"undefined"==typeof module||!module||!module.exports?"function"==typeof define&&define.amd?define([],function(){return a}):window.searchselect=a:module.exports=a;var c=window.jQuery;c!==void 0&&(c.fn.searchselect=function(){var d=Array.prototype.slice.call(arguments);return c(this).each(function(){d[0]&&"object"!=typeof d[0]?"string"==typeof d[0]&&a.prototype[d[0]].apply(new a(this),d.slice(1)):new a(this,d[0]||{})})})})();